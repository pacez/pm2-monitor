(this.webpackJsonpmonitor=this.webpackJsonpmonitor||[]).push([[0],{226:function(e,t,n){e.exports=n(426)},231:function(e,t,n){},268:function(e,t,n){},269:function(e,t,n){},318:function(e,t,n){},418:function(e,t,n){},420:function(e,t,n){},426:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),l=n(10),c=n.n(l),i=(n(231),n(113)),r=n(114),s=n(132),u=n(130),m=n(428),d=n(432),g=n(86),f=n(442),p=n(433),h=n(28),E=n(429),v=n(197),b=n.n(v),y=n(58),I=y.a.Map({loading:!1,loaded:!1,data:null,error:null}),S="system error!",C=b.a.create({baseURL:"//10.99.110.115:9000",timeout:1e4});C.interceptors.response.use((function(e){var t=e.data;return"string"===typeof t?t:y.a.fromJS(t)}),(function(e){console.log(e);try{var t=e.response,n=void 0===t?{}:t;return console.log(n),void(401===n.status&&(window.location.href="/login"))}catch(e){console.log(e)}return p.a.error(S),Promise.reject(e)}));var k=C,w=(n(268),function(){return o.a.createElement("div",{id:"loader"},o.a.createElement("div",{className:"sk-wave"},o.a.createElement("div",{className:"sk-rect sk-rect1"}),o.a.createElement("div",{className:"sk-rect sk-rect2"}),o.a.createElement("div",{className:"sk-rect sk-rect3"}),o.a.createElement("div",{className:"sk-rect sk-rect4"}),o.a.createElement("div",{className:"sk-rect sk-rect5"})))}),L=n(431),x=(n(269),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).state={loading:!1,log:""},e.fetchLog=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e.props.id;console.log(n),e.setState({loading:!t},(function(){k.get("/log2",{params:{id:n}}).then((function(t){e.setState({log:t})})).finally((function(){e.setState({loading:!1})}))}))},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("componentDidMount"),this.fetchLog(),window.logInterval=window.setInterval((function(){console.log("fetch log..."),e.fetchLog(!0)}),5e3)}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),window.clearInterval(window.logInterval)}},{key:"render",value:function(){var e=this.state,t=e.log,n=e.loading;return o.a.createElement(L.a,{width:"80%",visible:!0,footer:null,onCancel:this.props.onClose},n&&o.a.createElement(w,null),o.a.createElement("div",{className:"code"},o.a.createElement("pre",null,t)))}}]),n}(a.PureComponent)),N=n(434),j=n(435),D=n(436),O=n(437),M=n(438),A=n(439),P=n(443),F=n(440),B=(n(318),m.a.Header),T=m.a.Footer,_=m.a.Content,U=y.a.Map({visible:!1,id:null}),G=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return(e=t.call.apply(t,[this].concat(l))).state={loading:!1,log:U,gitlibList:I,porcessList:I,systemInfo:I},e.gitlibCols=[{width:30,title:"Index",dataIndex:"name",render:function(e,t,n){return n+1}},{title:"Name",dataIndex:"name"},{title:"Client",dataIndex:"client"},{title:"Branch",dataIndex:"branch",render:function(t,n,a){return o.a.createElement(d.a,{onChange:function(t){e.onChangeBranch(t.target.value,a)},value:t})}},{title:"Desc",dataIndex:"desc"},{title:"Action",dataIndex:"name",render:function(t){return o.a.createElement(g.a,{title:"Switch Branch",mouseEnterDelay:1},o.a.createElement("span",{onClick:e.switchBranch,className:"action-btn"},o.a.createElement(N.a,null)))}}],e.processCols=[{width:30,title:"Index",dataIndex:"name",render:function(e,t,n){return n+1}},{title:"Name",dataIndex:"name"},{title:"Task ID",dataIndex:"pm_id"},{title:"PID",dataIndex:"pid",key:"pid"},{title:"Status",dataIndex:"pm2_env",render:function(e){return e.status}},{title:"Uptime",dataIndex:"pm2_env",render:function(e){var t=new Date(e.pm_uptime);return"\n                        ".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate()," \n                        ").concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds(),"\n                    ")}},{title:"CPU",dataIndex:"monit",render:function(e){return"".concat(e.cpu,"%")}},{title:"Memory",dataIndex:"monit",render:function(e){return"".concat((e.memory/1048576).toFixed(2),"MB")}},{title:"Action",dataIndex:"pm_id",render:function(t,n){return o.a.createElement(o.a.Fragment,null,"online"===n.pm2_env.status&&"monitor"!==n.name&&o.a.createElement(g.a,{title:"Stop",mouseEnterDelay:1},o.a.createElement("span",{onClick:function(){e.processAction("stop",t)},className:"action-btn"},o.a.createElement(j.a,null))),"online"!==n.pm2_env.status&&"monitor"!==n.name&&o.a.createElement(g.a,{title:"Start",mouseEnterDelay:1},o.a.createElement("span",{onClick:function(){e.processAction("start",t)},className:"action-btn"},o.a.createElement(D.a,null))),o.a.createElement(g.a,{title:"Restart",mouseEnterDelay:1},o.a.createElement("span",{onClick:function(){e.processAction("restart",t)},className:"action-btn"},o.a.createElement(O.a,null))),"monitor"!==n.name&&o.a.createElement(g.a,{title:"Delete",mouseEnterDelay:1},o.a.createElement(f.a,{title:"Are you sure delete this task?",onConfirm:function(){e.processAction("delete",t)},okText:"Yes",cancelText:"No"},o.a.createElement("span",{className:"action-btn"}," ",o.a.createElement(M.a,null)," "))),o.a.createElement(g.a,{title:"Log",mouseEnterDelay:1},o.a.createElement("span",{onClick:function(){e.onLogVisible(!0,t)},className:"action-btn"},o.a.createElement(A.a,null))))}}],e.refresh=function(){e.fetchSystemInfo(),e.fetchProcess(),e.fetchGitlib()},e.restart=function(){k.get("/reboot");p.a.loading({key:"restartMessage",duration:30,content:"Restarting... It takes about 30 seconds\u3002"}),setTimeout((function(){window.location.reload()}),3e4)},e.logout=function(){e.setState({loading:!0},(function(){k.get("/logout").finally((function(){e.setState({loading:!1})}))}))},e.processAction=function(t,n){e.setState({loading:!0},(function(){k.get("/".concat(t),{params:{id:n}}).then((function(t){p.a.success("Operate Successfully!"),e.fetchProcess()})).finally((function(){e.setState({loading:!1})}))}))},e.onChangeBranch=function(t,n){var a=e.state.gitlibList;e.setState({gitlibList:a.setIn(["data",n,"branch"],t)})},e.switchBranch=function(){e.setState({loading:!0},(function(){k.post("/updateGitConfig",e.state.gitlibList.get("data").toJS()).then((function(t){p.a.success("Switch Branch Success!"),e.fetchGitlib()})).finally((function(){e.setState({loading:!1})}))}))},e.fetchSystemInfo=function(){var t=e.state.systemInfo;e.setState({systemInfo:t.set("loading",!0)},(function(){k.get("/getSystemInfo").then((function(n){e.setState({systemInfo:t.set("data",n).set("loaded",!0).set("loading",!1)})}))}))},e.fetchProcess=function(){var t=e.state.porcessList;e.setState({porcessList:t.set("loading",!0)},(function(){k.get("/getProccess").then((function(n){e.setState({porcessList:t.set("data",n).set("loaded",!0).set("loading",!1)})}))}))},e.fetchGitlib=function(){var t=e.state.gitlibList;e.setState({gitlibList:t.set("loading",!0)},(function(){k.get("/getGitConfig").then((function(n){e.setState({gitlibList:t.set("data",n).set("loaded",!0).set("loading",!1)})}))}))},e.onLogVisible=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log(t,n);var a=e.state.log;e.setState({log:a.set("visible",t).set("id",n)})},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.refresh()}},{key:"render",value:function(){var e=this,t=this.state,n=t.systemInfo,a=t.porcessList,l=t.gitlibList,c=t.loading,i=t.log;return o.a.createElement(o.a.Fragment,null,(c||n.get("loading")||a.get("loading"))&&o.a.createElement(w,null),i.get("visible")&&o.a.createElement(x,{id:i.get("id"),onClose:function(){e.onLogVisible(!1)}}),o.a.createElement(m.a,null,o.a.createElement(B,null,o.a.createElement("h1",{className:"header-title"},"Welcome To E-learning FE CI Monitor"),o.a.createElement("div",{className:"header-command"},o.a.createElement(h.a,{icon:o.a.createElement(P.a,null),type:"primary",onClick:this.refresh},"Refresh"),o.a.createElement(f.a,{title:"Are you sure restart server?",onConfirm:this.restart,okText:"Yes",cancelText:"No"},o.a.createElement(h.a,{icon:o.a.createElement(O.a,null),type:"primary",danger:!0},"Restart")),o.a.createElement(h.a,{onClick:this.logout,icon:o.a.createElement(F.a,null)},"Logout"))),o.a.createElement(_,{className:"content"},o.a.createElement("div",{id:"systemInfo",dangerouslySetInnerHTML:{__html:n.get("data")},className:"system-info"}),a.get("loaded")&&o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,"Process List"),o.a.createElement(E.a,{rowKey:"pid",pagination:!1,columns:this.processCols,dataSource:a.get("data",y.a.List()).toJS()})),l.get("loaded")&&o.a.createElement(o.a.Fragment,null,o.a.createElement("h1",null,"Gitlab Repositories"),o.a.createElement(E.a,{rowKey:"name",pagination:!1,columns:this.gitlibCols,dataSource:l.get("data",y.a.List()).toJS()}))),o.a.createElement(T,null,"E-learning FE CI Monitor copyright \xa9 2020   |    zhongpeizhi@beisen.com")))}}]),n}(a.PureComponent),J=n(162),R=n(430),H=(n(418),R.a.Item),W={labelCol:{span:6},wrapperCol:{span:16}},V=function(){var e=Object(a.useState)(""),t=Object(J.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)(""),i=Object(J.a)(c,2),r=i[0],s=i[1];return o.a.createElement("div",{className:"login"},o.a.createElement(m.a.Header,null,o.a.createElement("h1",null,"Welcome To E-learning FE CI Monitor")),o.a.createElement("div",{className:"form"},o.a.createElement(R.a,null,o.a.createElement(H,Object.assign({},W,{label:"Username"}),o.a.createElement(d.a,{placeholder:"Username",onChange:function(e){l(e.target.value)},value:n})),o.a.createElement(H,Object.assign({},W,{label:"Password"}),o.a.createElement(d.a,{placeholder:"Password",type:"password",onChange:function(e){s(e.target.value)},value:r}))),o.a.createElement(h.a,{onClick:function(){k.post("/loginCheck",{username:n,passwd:r}).then((function(e){window.location.href="/"}))}},"Sign In")))},Y=n(441),z=n(217),K=n(25),q=(n(420),function(){return o.a.createElement("div",{className:"App"},o.a.createElement(z.a,null,o.a.createElement(K.a,{path:"/",exact:!0,component:G}),o.a.createElement(K.a,{path:"/login",component:V})),o.a.createElement(Y.a,{visibilityHeight:50}))});c.a.render(o.a.createElement(q,null),document.getElementById("root"))}},[[226,1,2]]]);
//# sourceMappingURL=main.846145be.chunk.js.map